<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test OData via Proxy</title>
  </head>
  <body>
    <h1>RÃ©sultats OData (Produits)</h1>
    <ul class="list"></ul>

    <script>
      // ðŸŸ¢ Construction de la requÃªte OData complÃ¨te
      const odataQuery = "Products?$filter=UnitPrice gt 20&$select=ProductName,UnitPrice&$orderby=UnitPrice desc&$top=5";

      // ðŸ”µ Construction de l'URL proxy (uniquement le paramÃ¨tre 'query')
      const proxyUrl = `/proxy/odata?query=${encodeURIComponent(odataQuery)}`;
      console.log("âž¡ï¸ URL gÃ©nÃ©rÃ©e :", proxyUrl);
      const list = document.querySelector(".list");

      const fetchData = async () => {
        try {
          list.innerHTML = "Wait..."; // RÃ©initialiser la liste
          const response = await fetch(proxyUrl);
          if (!response.ok) throw new Error("Erreur rÃ©seau");

          const data = await response.json();
          console.log("RÃ©ponse OData :", data);

          list.innerHTML = ""; // RÃ©initialiser la liste
          if (!data.value) return;
          
          data.value.forEach((item) => {
            const li = document.createElement("li");
            li.textContent = `${item.ProductName} â€” ${item.UnitPrice} â‚¬`;
            list.appendChild(li);
          });
        } catch (err) {
          console.error("Erreur fetch :", err);
        }
      };

      fetchData();
    </script>
  </body>
</html>
